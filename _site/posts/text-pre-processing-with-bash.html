<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sina Ahmadi's personal website">
    <meta name="author" content="Sina Ahmadi">
    <meta name="keywords" content="Natural Language Processing, Kurdish, Kurdish language processing, Kurdish-BLARK, Computational Linguistics, less-resourced languages, پاڵاوتنی زمان, زمانی کوردی, تێکنۆلۆژیا بۆ زمان, زانست, سینا ئەحمەدی, پێواژۆکردنی زمانی سروشتی, Doğal dil işleme, traitement automatique du langage naturel, la langue kurde, le traitement automatique du kurde, zimanê kurdî, teknolojiya ji bo zimanê kurdî">
    <meta name="twitter:title" content="Sina Ahmadi's personal website">
    <meta property="og:image" content="https://sinaahmadi.github.io/docs/P_20180307_160121_BF.png">
    <meta property="og:description" content="Sina Ahmadi's personal website">
    <meta property="og:title" content="Sina Ahmadi's personal website">

    <title>
        
            Text pre-processing in command-line &middot; Sina Ahmadi's Personal Page
        
    </title>

    <script src="/theme/js/jquery-3.2.1.min.js"></script>
    <script src="/theme/js/popper.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/theme/css/bootstrap.css">
    <link rel="stylesheet" href="/theme/css/site.css">
    <link rel="stylesheet" href="/theme/css/syntax.css">
    <link rel="meta" type="application/rdf+xml" title="FOAF" href="foaf.rdf" /> 

</head>


<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top justify-content-between">
    <a class="navbar-brand font-weight-bold" href="/index.html">Sina Ahmadi</a>
    <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarContent" >
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav ml-auto">
        
            <li class="nav-item">
                <a href='/index.html'
                   class="nav-link">
                    Home
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/about.html'
                   class="nav-link">
                    About
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/publications.html'
                   class="nav-link">
                    Publications
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/teaching.html'
                   class="nav-link">
                    Teaching
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/list/posts.html'
                   class="nav-link">
                    Posts
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/list/resources.html'
                   class="nav-link">
                    Resources
                </a>
            </li>
        
        </ul>
    </div>
</nav>





<div class="container site-container" id="top">
    <div class="row">
        <div class="d-none d-lg-block col-lg-4 col-xl-4 side">
            








    <div class="sticky-top space-before">
    <div class="card bg-light mb-3 space-before">
        <div class="card-body">
            <div class="card-title">
                <h5>On This Page</h5>
                <h6>Apr 16, 2019</h6>
            </div>
              <ul class="nav flex-column nav-pills header-list">
            </ul>
            <hr>
            <div class="d-flex flex-wrap align-items-center">
                <span class="icon grey mr-2 mb-2">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Price_tag" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<g>
	<path d="M19.388,0.405c-0.111-0.314-0.454-0.48-0.769-0.371c-0.315,0.109-0.481,0.455-0.372,0.77
		c0.929,2.67-0.915,4.664-2.321,5.732l-0.568-0.814c-0.191-0.273-0.618-0.5-0.95-0.504L11.22,5.232
		c-0.332-0.006-0.825,0.146-1.097,0.338l-9.394,6.587c-0.455,0.32-0.565,0.947-0.247,1.404l4.269,6.108
		c0.32,0.455,0.831,0.4,1.287,0.082l9.394-6.588c0.27-0.191,0.582-0.603,0.692-0.918l0.998-3.145
		c0.11-0.314,0.043-0.793-0.148-1.066l-0.346-0.496C18.516,6.091,20.476,3.534,19.388,0.405z M15.017,9.763
		c-0.727,0.51-1.731,0.332-2.24-0.396c-0.511-0.73-0.333-1.734,0.395-2.246C13.75,6.716,14.5,6.745,15.04,7.138
		c-0.272,0.164-0.459,0.26-0.494,0.275c-0.301,0.143-0.43,0.504-0.288,0.805c0.104,0.219,0.321,0.348,0.547,0.348
		c0.086,0,0.174-0.02,0.257-0.059c0.194-0.092,0.402-0.201,0.619-0.33C15.778,8.771,15.542,9.394,15.017,9.763z"/>
</g>
</svg>

                </span>
                
                    <a href="/list/posts.html#nlp"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        NLP
                    </a>
                
                    <a href="/list/posts.html#text-processing"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Text processing
                    </a>
                
                    <a href="/list/posts.html#bash"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Bash
                    </a>
                
                    <a href="/list/posts.html#tutorial"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Tutorial
                    </a>
                
            </div>
            <hr>
            <div class="d-flex align-items-center mt-2">
                <span class="icon grey mr-1">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Arrow_left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path d="M2.5,10L9,3.5V7h8v6H9v3.5L2.5,10z"/>
</svg>

                </span>
                <a href="/list/posts.html">Back to all posts</a>
            </div>
        </div>
    </div>
</div>






        </div>
        <div class="col-md-12 col-lg-8 col-xl-8 pb-4 content">
            <h1 class="border border-top-0 border-right-0 border-left-0 mb-3 pb-2">
    Text pre-processing in command-line
</h1>

<div class="d-md-block d-lg-none">
    <div class="sticky-top space-before">
    <div class="card bg-light mb-3 space-before">
        <div class="card-body">
            <div class="card-title">
                <h5>On This Page</h5>
                <h6>Apr 16, 2019</h6>
            </div>
              <ul class="nav flex-column nav-pills header-list">
            </ul>
            <hr>
            <div class="d-flex flex-wrap align-items-center">
                <span class="icon grey mr-2 mb-2">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Price_tag" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<g>
	<path d="M19.388,0.405c-0.111-0.314-0.454-0.48-0.769-0.371c-0.315,0.109-0.481,0.455-0.372,0.77
		c0.929,2.67-0.915,4.664-2.321,5.732l-0.568-0.814c-0.191-0.273-0.618-0.5-0.95-0.504L11.22,5.232
		c-0.332-0.006-0.825,0.146-1.097,0.338l-9.394,6.587c-0.455,0.32-0.565,0.947-0.247,1.404l4.269,6.108
		c0.32,0.455,0.831,0.4,1.287,0.082l9.394-6.588c0.27-0.191,0.582-0.603,0.692-0.918l0.998-3.145
		c0.11-0.314,0.043-0.793-0.148-1.066l-0.346-0.496C18.516,6.091,20.476,3.534,19.388,0.405z M15.017,9.763
		c-0.727,0.51-1.731,0.332-2.24-0.396c-0.511-0.73-0.333-1.734,0.395-2.246C13.75,6.716,14.5,6.745,15.04,7.138
		c-0.272,0.164-0.459,0.26-0.494,0.275c-0.301,0.143-0.43,0.504-0.288,0.805c0.104,0.219,0.321,0.348,0.547,0.348
		c0.086,0,0.174-0.02,0.257-0.059c0.194-0.092,0.402-0.201,0.619-0.33C15.778,8.771,15.542,9.394,15.017,9.763z"/>
</g>
</svg>

                </span>
                
                    <a href="/list/posts.html#nlp"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        NLP
                    </a>
                
                    <a href="/list/posts.html#text-processing"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Text processing
                    </a>
                
                    <a href="/list/posts.html#bash"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Bash
                    </a>
                
                    <a href="/list/posts.html#tutorial"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Tutorial
                    </a>
                
            </div>
            <hr>
            <div class="d-flex align-items-center mt-2">
                <span class="icon grey mr-1">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Arrow_left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path d="M2.5,10L9,3.5V7h8v6H9v3.5L2.5,10z"/>
</svg>

                </span>
                <a href="/list/posts.html">Back to all posts</a>
            </div>
        </div>
    </div>
</div>

</div>

<p>Whether your are a newbie or professional in natural language processing or data mining, text pre-processing is a task that you need to go through at some point. Although there is a plethora of libraries which do the pre-processing of your text perfectly, none of them may have <strong>power, simplicity</strong> and <strong>flexibility</strong> that the command-line programs provide to you. In this tutorial, a few simple but essential programs are introduced for text pre-processing in <a href="https://en.wikipedia.org/wiki/Command-line_interface" target="_blank"><strong>command-line</strong></a>.</p>

<p>What we mean by <strong>text pre-processing</strong> is the normalisation of text by removing special characters (e.g. punctuation marks, non-Unicode characters etc.), tokens or changing the whole structure of the text for a specific purpose (e.g. adding <code class="language-plaintext highlighter-rouge">&lt;eos&gt;</code> to the end of sentences for training neural networks). In other words, whatever required to prepare a text file to be processed is a part of text pre-processing. Later, we will discuss text processing tasks such as <u>counting unique words</u> in a document, <u>sorting words by frequency</u>, <u>removing stop words</u>, <u>retrieving specific text structures</u>.</p>

<div class="card mb-3 text-center">
    <img class="rounded mx-auto d-block" src="http://localhost:4000/docs/images/command_line_text_preprocessing.png" style="width:75%" align="middle" alt="Text pre-processing using command-line" />
    <div class="card-body bg-light">
        <div class="card-text">
            Text pre-processing is fun with command-line.
        </div>
    </div>
</div>

<p>Obviously, for one problem there may be more than one solution. However, in this tutorial, only a few techniques and programs are introduced. It will be up to you, your preference and the requirements of your tasks to decide which command fits better to your problem. Personally, I love the command-line and how each program can be used as a piece of puzzle, thanks to <strong>pipes</strong>, to solve sophisticated problems, particularly where processing time and performance matter.</p>

<p><strong>System setup</strong>: The commands in this tutorial have been tested on GNU bash, version 5.0.2(1)-release (x86_64-apple-darwin18.2.0). You will normally have no problem running them on any Unix-based operating system. If you are a Windows user, the best solution is to start using a Linux-based open-source operating system like <a href="https://www.ubuntu.com/" target="_blank">Ubuntu</a> (seriously, do it!). Otherwise, you can simply install <a href="https://www.cygwin.com/" target="_blank">Cygwin</a> which lets you enjoy GNU in you Windows, <em>somehow</em>!</p>

<p>If you are not familiar with command-line, particularly Bash–the command language interpreter for the GNU operating system, you should learn the basic concepts, features and commands. This <a href="https://tiswww.case.edu/php/chet/bash/bashref.html" target="_blank">reference manual</a> may be useful. Recall that you may use the <code class="language-plaintext highlighter-rouge">man</code> command to display the user manual of any command.</p>

<h2 id="text-preprocessing-commands">Text-preprocessing commands</h2>

<p>If you are interested in executing the commands in practice, you can download <a href="http://localhost:4000/docs/tutorials/noisy_text.txt" target="_blank">this text file</a> in your working directory and see how each command works. Our sample text is very noisy; it contains html tags, indented paragraphs, multiple unnecessary newlines, spaces and tokens. <strong>Our goal</strong> is to clean this sample text by getting rid of the noisy stuff.</p>

<h3 id="text-reading">Text reading</h3>

<p>The very first step of any task in text (pre-)processing is text reading. We will see later in this tutorial that some commands, like <code class="language-plaintext highlighter-rouge">wc</code>, take care of the text reading without requiring us to do any further commands for reading.</p>

<h4 id="cat"><code class="language-plaintext highlighter-rouge">cat</code></h4>
<h5 id="syntax-cat-options-filenames">Syntax: <code class="language-plaintext highlighter-rouge">cat [options] [filenames]</code></h5>

<p>The <code class="language-plaintext highlighter-rouge">cat</code> command (short for “concatenate“) is one of the most frequent commands which not only allows us to read files, but also create, display and concatenate them.</p>

<p>The following command prints out the whole file content in your command-line:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt</code></pre></figure>

<p>You may use the <code class="language-plaintext highlighter-rouge">less</code> command which lets you scroll through the file without having all the file content displayed on the command-line. <strong>Don’t forget to use pipes</strong>, i.e. <code class="language-plaintext highlighter-rouge">|</code> whenever you want to use the output of a command as the input of another command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt | less</code></pre></figure>

<p>To exit the viewing window press <code class="language-plaintext highlighter-rouge">q</code>.</p>

<p>You may write your file content in a new file like:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt <span class="o">&gt;</span> new_noisy_text.txt
<span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt <span class="o">&gt;&gt;</span> new_noisy_text.txt</code></pre></figure>

<p>The difference between <code class="language-plaintext highlighter-rouge">&gt;</code> and <code class="language-plaintext highlighter-rouge">&gt;&gt;</code> is that the first one overwrites the file if it already exists while the latter one keeps the content untouched and appends to the existing file.</p>

<p><code class="language-plaintext highlighter-rouge">cat</code> can also turn your command-line into a basic text editor as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> quick_note.txt
This is a quick note to remember that I should call the clinic asap.
<span class="nv">$ </span>  </code></pre></figure>

<p>By using <code class="language-plaintext highlighter-rouge">cat &gt; quick_note.txt</code>, you are creating a new file and allowing <code class="language-plaintext highlighter-rouge">cat</code> to write whatever you type in the command-line as the content of your file. Once you are done with typing, <code class="language-plaintext highlighter-rouge">cntrl-d</code> saves the content and returns the command-line to its normal functionality.</p>

<p>The awesomeness of <code class="language-plaintext highlighter-rouge">cat</code> is not limited to these! You can concatenate multiple files into one as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>semester1_2019_results.txt semester2_2019_results.txt <span class="o">&gt;</span> 2019_results.txt</code></pre></figure>

<p>This way, the content of those two files is merged into a new file called <em>2019_results.txt</em>.</p>

<h4 id="head-and-tail"><code class="language-plaintext highlighter-rouge">head</code> and <code class="language-plaintext highlighter-rouge">tail</code></h4>
<h5 id="syntax-head-options-files-tail-options-files">Syntax: <code class="language-plaintext highlighter-rouge">head [options] [file(s)]</code>, <code class="language-plaintext highlighter-rouge">tail [options] [file(s)]</code></h5>

<p>Sometimes you only want to take a look at how the content of a file looks like. <code class="language-plaintext highlighter-rouge">head</code> and <code class="language-plaintext highlighter-rouge">tail</code> are two commands which allow us to view a certain number of lines of a file, respectively at the beginning and the end.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">head </span>noisy_text.txt</code></pre></figure>

<p>There is an interesting option <code class="language-plaintext highlighter-rouge">-n</code> which lets us to specify how many lines be displayed. The default value is 10 lines.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">head</span> <span class="nt">-n</span> 2  noisy_text.txt
   0001193125-12-075999.txt : 20120224 0001193125-12-075999.hdr.sgml :
   20120224 20120223203324 ACCESSION NUMBER: 0001193125-12-075999
<span class="nv">$ </span><span class="nb">tail</span> <span class="nt">-n</span> 2 noisy_text.txt
  84. javascript:void<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
  85. javascript:void<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
<span class="nv">$ </span>  </code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">head</code> and <code class="language-plaintext highlighter-rouge">tail</code> allow further manoeuvres by using them in various orders with pipes and different options. Suppose that you have file containing 1000 lines and you would like to read lines 286 to 300. One way to do so is the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">head</span> <span class="nt">-n</span> 300 noisy_text.txt | <span class="nb">tail</span> <span class="nt">-n</span> 14</code></pre></figure>

<h5 id="get-a-block-of-text-with-awk">Get a block of text with <code class="language-plaintext highlighter-rouge">awk</code></h5>

<p>But what if you only want a specific range of lines in your file? Well, you can use <code class="language-plaintext highlighter-rouge">awk</code> as the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">awk</span> <span class="s1">'NR &gt;= first_line &amp;&amp; NR &lt;= last_line'</span></code></pre></figure>

<p>where the <em>first_line</em> and <em>last_line</em> should be replaced by the line range that you are interested in. For instance, the lines 48 to 51 in our sample file are:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt | <span class="nb">awk</span> <span class="s1">'NR &gt;= 818 &amp;&amp; NR &lt;= 820'</span>

         Atlantic City Electric Company, which was incorporated <span class="k">in </span>New Jersey <span class="k">in
         </span>1924.
<span class="nv">$ </span>  </code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">awk</code> is a very useful command in text (pre)processing that we will discuss later.</p>

<h3 id="conversion-to-utf-8-with-iconv">Conversion to UTF-8 with <code class="language-plaintext highlighter-rouge">iconv</code></h3>
<h4 id="syntax-iconv--f-source-encoding-code--t-target-encoding-code--inputfile---outputfile">Syntax: <code class="language-plaintext highlighter-rouge">iconv -f source-encoding-code -t target-encoding-code &lt; inputfile  &gt; outputfile</code></h4>

<p>Although nowadays <a href="https://www.unicode.org/" target="_blank">Unicode standard</a> is the default encoding of most programs and on the web, there are still texts for which older encodings such as ISO 8859 and Windows-1252 were used and therefore, converting them is necessary. For this purpose, there is a program called <code class="language-plaintext highlighter-rouge">iconv</code> which converts your text from an encoding to another one. The syntax of <code class="language-plaintext highlighter-rouge">iconv</code> is shown above; Change the <code class="language-plaintext highlighter-rouge">source-encoding-code</code> and the <code class="language-plaintext highlighter-rouge">target-encoding-code</code> to the encoding of your source text and your desired output encoding, respectively.</p>

<p>Our <a href="http://localhost:4000/docs/tutorials/noisy_text.txt" target="_blank">sample text file</a> is encoded in UTF-8. The following is an example to convert “crépuscule” from UTF-8 to ISO-8859-15:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"crépuscule"</span> | iconv <span class="nt">-f</span> UTF-8 <span class="nt">-t</span> ISO-8859-15
cr?puscule
<span class="nv">$ </span>   </code></pre></figure>

<p>Recall that <code class="language-plaintext highlighter-rouge">echo</code> displays a text on standard output.</p>

<p>Any characters that <code class="language-plaintext highlighter-rouge">iconv</code> does not know how to convert will be replaced with question marks. This may not be good when conversion accuracy matters. However, when dealing with large number of files, I personally prefer having a bunch of <code class="language-plaintext highlighter-rouge">?</code>s to prevent any text reading errors!</p>

<h3 id="replace-characters-using-tr">Replace characters using <code class="language-plaintext highlighter-rouge">tr</code></h3>
<h4 id="syntax-tr-options-set1-set2">Syntax: <code class="language-plaintext highlighter-rouge">tr [options] [set1] [set2]</code></h4>

<p>Replacing or removing specific characters is also a part of text pre-processing. For instance, unnecessary spaces or newlines may not be welcomed for some tasks. <code class="language-plaintext highlighter-rouge">tr</code>, abbreviation of <em>translate</em> or <em>transliterate</em>, is a very useful command which deals with such cases.</p>

<p>Suppose that you have the following text in Greek, where <code class="language-plaintext highlighter-rouge">;</code> is normally used as <code class="language-plaintext highlighter-rouge">?</code>, and you want to replace <code class="language-plaintext highlighter-rouge">;</code> with <code class="language-plaintext highlighter-rouge">?</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Πώς θέλετε να πληρώσετε;"</span> | <span class="nb">tr</span> <span class="s2">";"</span> <span class="s2">"?"</span>
Πώς θέλετε να πληρώσετε?
<span class="nv">$ </span>  </code></pre></figure>

<p>or, replacing spaces by newlines:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Amount of plastic in ocean is worse than we thought, study says"</span> | <span class="nb">tr</span> <span class="s2">" "</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
Amount
of
plastic
<span class="k">in
</span>ocean
is
worse
than
we
thought,
study
says
<span class="nv">$ </span>  </code></pre></figure>

<p>Replacing characters can also be done with a sequence of characters as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Amount of plastic in ocean is worse than we thought, study says"</span> | <span class="nb">tr</span> <span class="s2">"iplo"</span> <span class="s2">"abnu"</span>
Amuunt uf bnastac an ucean as wurse than we thuught, study says
<span class="nv">$ </span>  </code></pre></figure>

<p>In this case, <code class="language-plaintext highlighter-rouge">tr</code> simply translates a character in the first set “iplo” to its corresponding one in the second set “abnu”.</p>

<p><code class="language-plaintext highlighter-rouge">tr</code> also supports character sets such as <code class="language-plaintext highlighter-rouge">a-z</code>, <code class="language-plaintext highlighter-rouge">A-Z</code> and <code class="language-plaintext highlighter-rouge">0-9</code> to represent lower case alphabets, upper case alphabets and digits, respectively:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Amount of plastic in ocean is worse than we thought, study says"</span> | <span class="nb">tr</span> <span class="s1">'a-z'</span> <span class="s1">'A-Z'</span>
AMOUNT OF PLASTIC IN OCEAN IS WORSE THAN WE THOUGHT, STUDY SAYS
<span class="nv">$ </span>  </code></pre></figure>

<p>What if we want to replace multiple occurrences of a character by another character? For instance, line 340 to 363 in the <a href="http://localhost:4000/docs/tutorials/noisy_text.txt" target="_blank">sample text file</a> contain multiple spaces that we would like to be removed and be replaced by one. This can be done with the <code class="language-plaintext highlighter-rouge">-s</code> option of <code class="language-plaintext highlighter-rouge">tr</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt | <span class="nb">awk</span> <span class="s1">'NR &gt;= 340  &amp;&amp; NR &lt;= 350'</span>

                                  <span class="o">[</span>3]PART I

                                 <span class="o">[</span>4]Item 1.
                             -       Business      3

                                 <span class="o">[</span>5]Item 1A.
                           -       Risk Factors      23

                                 <span class="o">[</span>6]Item 1B.
                    -       Unresolved Staff Comments      37

<span class="nv">$ </span> </code></pre></figure>

<p>The text looks like the following after removing multiple spaces and newlines:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt | <span class="nb">awk</span> <span class="s1">'NR &gt;= 340  &amp;&amp; NR &lt;= 350'</span> | <span class="nb">tr</span> <span class="nt">-s</span> <span class="s2">" "</span> | <span class="nb">tr</span> <span class="nt">-s</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>

 <span class="o">[</span>3]PART I
 <span class="o">[</span>4]Item 1.
 - Business 3
 <span class="o">[</span>5]Item 1A.
 - Risk Factors 23
 <span class="o">[</span>6]Item 1B.
 - Unresolved Staff Comments 37

<span class="nv">$ </span> </code></pre></figure>

<p>To delete all the occurrences of a character, you can use <code class="language-plaintext highlighter-rouge">tr -d [set]</code> which acts like <code class="language-plaintext highlighter-rouge">tr [set] ""</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Amount of plastic in ocean is worse than we thought, study says"</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s2">"o"</span>
Amunt f plastic <span class="k">in </span>cean is wrse than we thught, study says
<span class="nv">$ </span> </code></pre></figure>

<p>To discover more interesting options, try <code class="language-plaintext highlighter-rouge">man tr</code>.</p>

<h3 id="remove-html-tags-or-anything-between-tags">Remove HTML tags (or anything between tags)</h3>

<p>The commands that we introduced so far were used directly over the text with simple patterns. What if we need to deal with more sophisticated text patterns? This is where regular expressions (regex) come in!</p>

<p>Regex allow us to access parts of a text based on the rules that we define. In some ways, a regex is analogous to a database query or a semantic query. It’s a query to extract information from raw text!</p>

<p>Let’s take a look at our <a href="http://localhost:4000/docs/tutorials/noisy_text.txt" target="_blank">sample text file</a> where lines 1215 to 1220 contain HTML code (look like an HTML table):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt | <span class="nb">awk</span> <span class="s1">'NR &gt;= 1215 &amp;&amp; NR &lt;= 1220'</span>
   <span class="nv">style</span><span class="o">=</span><span class="s2">"font-family: Times New Roman;"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"_mt"</span>
   &lt;<span class="nv">size</span><span class="o">=</span><span class="s2">"2"</span><span class="o">&gt;)</span>&amp;nbsp<span class="p">;</span>&lt;/font&gt;&lt;/td&gt; &lt;td <span class="nv">valign</span><span class="o">=</span><span class="s2">"bottom"</span><span class="o">&gt;</span>&lt;font <span class="nv">class</span><span class="o">=</span><span class="s2">"_mt"</span>
   &lt;<span class="nv">size</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span>&amp;nbsp<span class="p">;</span>&lt;/font&gt;&lt;/td&gt; &lt;td <span class="nv">valign</span><span class="o">=</span><span class="s2">"bottom"</span><span class="o">&gt;</span>&lt;font
   <span class="nv">style</span><span class="o">=</span><span class="s2">"font-family: Times New Roman;"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"_mt"</span>
   &lt;<span class="nv">size</span><span class="o">=</span><span class="s2">"2"</span><span class="o">&gt;</span>&amp;nbsp<span class="p">;</span>&lt;/font&gt;&lt;/td&gt; &lt;td <span class="nv">valign</span><span class="o">=</span><span class="s2">"bottom"</span> <span class="nv">align</span><span class="o">=</span><span class="s2">"right"</span><span class="o">&gt;</span>&lt;font
   <span class="nv">style</span><span class="o">=</span><span class="s2">"font-family: Times New Roman;"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"_mt"</span>
<span class="nv">$ </span>  </code></pre></figure>

<p>Let’s assume that we want to remove the tags, i.e. anything between &lt; and &gt; and we only want to keep whatever enclosed by tags. To do so, we create a regular expression which looks for anything starting with a &lt; and proceeds until it gets to a &gt;; the regex includes anything between those two characters, except a &gt;. This regex is: <code class="language-plaintext highlighter-rouge">/&lt;[^&gt;]*&gt;/</code>.</p>

<p>For this problem, we use <a href="https://www.perl.org/" target="_blank">Perl</a> which is a programming language frequently used in text processing thanks to its facilities. It can also be used in the command-line just like other commands.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt | <span class="nb">awk</span> <span class="s1">'NR &gt;= 1215 &amp;&amp; NR &lt;= 1220'</span> | perl <span class="nt">-0777</span> <span class="nt">-pe</span> <span class="s1">'s/&lt;[^&gt;]*&gt;//gs'</span>
   <span class="nv">style</span><span class="o">=</span><span class="s2">"font-family: Times New Roman;"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"_mt"</span>
   <span class="o">)</span>&amp;nbsp<span class="p">;</span> &amp;nbsp<span class="p">;</span> &amp;nbsp<span class="p">;</span> &lt;font
   <span class="nv">style</span><span class="o">=</span><span class="s2">"font-family: Times New Roman;"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"_mt"</span>
<span class="nv">$ </span> </code></pre></figure>

<p>There are a few details that we should know.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">-0777</code> option lets us to slurp the file and feed all the lines to Perl in one go.</li>
  <li><code class="language-plaintext highlighter-rouge">-pe</code> is composed of two flags: <code class="language-plaintext highlighter-rouge">e</code> which allows us to specify the Perl code to be run and, <code class="language-plaintext highlighter-rouge">-p</code> flag processes the file line by line.</li>
  <li><code class="language-plaintext highlighter-rouge">s/[set1]/[set2]/</code> is the substitution operator which substitutes <code class="language-plaintext highlighter-rouge">[set1]</code> by <code class="language-plaintext highlighter-rouge">[set2]</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">/g</code> is the global flag which does the matching over the whole text.</li>
  <li><code class="language-plaintext highlighter-rouge">/s</code> treats the string as a single long line (only difference is that <code class="language-plaintext highlighter-rouge">\n</code> is also included when <code class="language-plaintext highlighter-rouge">.</code> is used).</li>
</ul>

<p>Another example with Perl. The following regular expression replaces newlines with more than two occurrences with only two newlines. This can also be done with the previous commands that we introduced, like <code class="language-plaintext highlighter-rouge">tr</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>perl <span class="nt">-0777</span> <span class="nt">-pe</span> <span class="s1">'s/(\n[ ]*){2,}/\n\n/gmi'</span></code></pre></figure>

<p><a href="https://perldoc.perl.org/perlrequick.html" target="_blank">Here</a> you can learn more about the fascinating functionalities of regular expressions in Perl. Most of the text editors make it easy to test and debug regular expressions and visualizing them. There are also many websites for the same purpose, such as <a href="https://regex101.com/" target="_blank">https://regex101.com/</a>.</p>

<h3 id="text-split-with-split">Text split with <code class="language-plaintext highlighter-rouge">split</code></h3>
<h4 id="syntax-split-options-filename-prefix">Syntax: <code class="language-plaintext highlighter-rouge">split [options] filename prefix</code></h4>

<p>We perviously mentioned how to merge files using <code class="language-plaintext highlighter-rouge">cat</code>. What if we want to split a huge text file into smaller parts? This can be done with <code class="language-plaintext highlighter-rouge">split</code>.</p>

<p><code class="language-plaintext highlighter-rouge">split</code> allows us to split a file based on the number of lines with <code class="language-plaintext highlighter-rouge">-l</code> option and based on size with <code class="language-plaintext highlighter-rouge">-b</code>. Let’s split our <a href="http://localhost:4000/docs/tutorials/noisy_text.txt" target="_blank">sample text file</a> into smaller files containing 500 lines each one:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">split</span> <span class="nt">-l</span> 500 noisy_text.txt
<span class="nv">$ </span>tree
<span class="nb">.</span>
├── noisy_text.txt
├── xaa
├── xab
├── xac
└── xad

0 directories, 5 files
<span class="nv">$ </span>   </code></pre></figure>

<h3 id="wrapping-up">Wrapping up</h3>

<p>How your text is to be pre-processed depends on the content of your file and your pre-processing purpose. You should know what the noisy stuff are and the issues that should be cleaned or normalised.</p>

<p>Suppose that we need the following steps to clean our <a href="http://localhost:4000/docs/tutorials/noisy_text.txt" target="_blank">sample text file</a>:</p>
<ul>
  <li>Remove HTML tags (<code class="language-plaintext highlighter-rouge">perl -0777 -pe 's/&lt;[^&gt;]*&gt;//gs'</code>)</li>
  <li>Remove noisy non-alphanumeric content  (<code class="language-plaintext highlighter-rouge">perl -0777 -pe 's/^[\S]*[^\w\s][\S]*$//gmi'</code>)</li>
  <li>Remove unwanted tokens, like <code class="language-plaintext highlighter-rouge">javascript:void(0);</code>, and characters (<code class="language-plaintext highlighter-rouge">awk '{gsub(/^.*javascript.*$/,"\n"); print }'</code> or <code class="language-plaintext highlighter-rouge">awk '{gsub(/&amp;nbsp;/," "); print }'</code>)</li>
</ul>

<p>Following the techniques introduced earlier in this tutorial, we clean the sample text as follows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>noisy_text.txt | <span class="nb">awk</span> <span class="s1">'{gsub(/^ */,""); print }'</span> | <span class="nb">tr</span> <span class="nt">-s</span> <span class="s2">" "</span> | perl <span class="nt">-0777</span> <span class="nt">-pe</span> <span class="s1">'s/^[\S]*[^\w\s][\S]*$//gmi'</span> |  perl <span class="nt">-0777</span> <span class="nt">-pe</span> <span class="s1">'s/&lt;[^&gt;]*&gt;//gs'</span> | <span class="nb">awk</span> <span class="s1">'{gsub(/^.*javascript.*$/,"\n"); print }'</span> | <span class="nb">awk</span> <span class="s1">'{gsub(/&amp;nbsp;/," "); print }'</span> | perl <span class="nt">-0777</span> <span class="nt">-pe</span> <span class="s1">'s/(\n[ ]*){2,}/\n\n/gmi'</span> <span class="o">&gt;</span> cleaned_noisy_text.txt
<span class="nv">$ </span>   </code></pre></figure>

<p><a href="http://localhost:4000/docs/tutorials/cleaned_noisy_text.txt" target="_blank">This is</a> how this long command cleans our sample text file like a charm!</p>

<hr class="col-xs-12" />

<p>Last updated on 28 April 2019.</p>



  

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/posts/text-pre-processing-with-bash.html';
      this.page.identifier = 'http://localhost:4000/posts/text-pre-processing-with-bash.html';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://sinaahmadi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





<script type="text/javascript">
    $(document).ready(function() {
        var tpl =
            "<li class='nav-item'>\
                <a class='nav-link bg-white mb-1' href='#header[idx]'>[name]</a>\
            </li>"
        $("h2").each(function(idx, h2) {
            $(h2).attr("id", "header" + idx)
            var name = $(h2).text().trim()
            var dom_string = tpl.replace("[name]", name).replace("[idx]", idx)
            var header = $(dom_string)
            $(".header-list").append(header)
        })
    })
</script>

<script type="text/javascript">
window.MathJax = {
  tex: {
    packages: ['base', 'ams']
  },
  loader: {
    load: ['ui/menu', '[tex]/ams']
  },
  startup: {
    ready() {
      MathJax.startup.defaultReady();
      const Macro = MathJax._.input.tex.Symbol.Macro;
      const MapHandler = MathJax._.input.tex.MapHandler.MapHandler;
      const Array = MathJax._.input.tex.ams.AmsMethods.default.Array;
      const env = new Macro('psmallmatrix', Array, [null, '(', ')', 'c', '.333em', '.2em', 'S', 1]);
      MapHandler.getMap('AMSmath-environment').add('psmallmatrix', env);
    }
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


        </div>
        <div class="col-md-12 d-lg-none bottom">
            

        </div>
    </div>
</div>

<script type="text/javascript">
/*!
 * IE10 viewport hack for Surface/desktop Windows 8 bug
 * Copyright 2014-2017 The Bootstrap Authors
 * Copyright 2014-2017 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

// See the Getting Started docs for more information:
// https://getbootstrap.com/getting-started/#support-ie10-width

(function () {
    'use strict'

    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
        var msViewportStyle = document.createElement('style')
        msViewportStyle.appendChild(
            document.createTextNode(
                '@-ms-viewport{width:auto!important}'
            )
        )
        document.head.appendChild(msViewportStyle)
    }
}())
</script>



</body>

</html>
