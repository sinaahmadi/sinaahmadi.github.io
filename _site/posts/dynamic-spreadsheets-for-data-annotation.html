<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>
        
            Dynamic spreadsheets for data linking annotation &middot; Sina Ahmadi's Personal Page
        
    </title>

    <script src="/theme/js/jquery-3.2.1.min.js"></script>
    <script src="/theme/js/popper.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/theme/css/bootstrap.css">
    <link rel="stylesheet" href="/theme/css/site.css">
    <link rel="stylesheet" href="/theme/css/syntax.css">
    <link rel="meta" type="application/rdf+xml" title="FOAF" href="foaf.rdf" /> 

</head>


<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top justify-content-between">
    <a class="navbar-brand font-weight-bold" href="/index.html">Sina Ahmadi</a>
    <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarContent" >
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav ml-auto">
        
            <li class="nav-item">
                <a href='/index.html'
                   class="nav-link">
                    Home
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/about.html'
                   class="nav-link">
                    About
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/publications.html'
                   class="nav-link">
                    Publications
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/teaching.html'
                   class="nav-link">
                    Teaching
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/list/posts.html'
                   class="nav-link">
                    Posts
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/list/resources.html'
                   class="nav-link">
                    Resources
                </a>
            </li>
        
        </ul>
    </div>
</nav>





<div class="container site-container" id="top">
    <div class="row">
        <div class="d-none d-lg-block col-lg-4 col-xl-4 side">
            








    <div class="sticky-top space-before">
    <div class="card bg-light mb-3 space-before">
        <div class="card-body">
            <div class="card-title">
                <h5>On This Page</h5>
                <h6>Jul 31, 2019</h6>
            </div>
              <ul class="nav flex-column nav-pills header-list">
            </ul>
            <hr>
            <div class="d-flex flex-wrap align-items-center">
                <span class="icon grey mr-2 mb-2">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Price_tag" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<g>
	<path d="M19.388,0.405c-0.111-0.314-0.454-0.48-0.769-0.371c-0.315,0.109-0.481,0.455-0.372,0.77
		c0.929,2.67-0.915,4.664-2.321,5.732l-0.568-0.814c-0.191-0.273-0.618-0.5-0.95-0.504L11.22,5.232
		c-0.332-0.006-0.825,0.146-1.097,0.338l-9.394,6.587c-0.455,0.32-0.565,0.947-0.247,1.404l4.269,6.108
		c0.32,0.455,0.831,0.4,1.287,0.082l9.394-6.588c0.27-0.191,0.582-0.603,0.692-0.918l0.998-3.145
		c0.11-0.314,0.043-0.793-0.148-1.066l-0.346-0.496C18.516,6.091,20.476,3.534,19.388,0.405z M15.017,9.763
		c-0.727,0.51-1.731,0.332-2.24-0.396c-0.511-0.73-0.333-1.734,0.395-2.246C13.75,6.716,14.5,6.745,15.04,7.138
		c-0.272,0.164-0.459,0.26-0.494,0.275c-0.301,0.143-0.43,0.504-0.288,0.805c0.104,0.219,0.321,0.348,0.547,0.348
		c0.086,0,0.174-0.02,0.257-0.059c0.194-0.092,0.402-0.201,0.619-0.33C15.778,8.771,15.542,9.394,15.017,9.763z"/>
</g>
</svg>

                </span>
                
                    <a href="/list/posts.html#data-mining"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Data mining
                    </a>
                
                    <a href="/list/posts.html#data-linking"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Data linking
                    </a>
                
                    <a href="/list/posts.html#nlp"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        NLP
                    </a>
                
                    <a href="/list/posts.html#apps-script"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Apps Script
                    </a>
                
                    <a href="/list/posts.html#tutorial"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Tutorial
                    </a>
                
            </div>
            <hr>
            <div class="d-flex align-items-center mt-2">
                <span class="icon grey mr-1">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Arrow_left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path d="M2.5,10L9,3.5V7h8v6H9v3.5L2.5,10z"/>
</svg>

                </span>
                <a href="/list/posts.html">Back to all posts</a>
            </div>
        </div>
    </div>
</div>






        </div>
        <div class="col-md-12 col-lg-8 col-xl-8 pb-4 content">
            <h1 class="border border-top-0 border-right-0 border-left-0 mb-3 pb-2">
    Dynamic spreadsheets for data linking annotation
</h1>

<div class="d-md-block d-lg-none">
    <div class="sticky-top space-before">
    <div class="card bg-light mb-3 space-before">
        <div class="card-body">
            <div class="card-title">
                <h5>On This Page</h5>
                <h6>Jul 31, 2019</h6>
            </div>
              <ul class="nav flex-column nav-pills header-list">
            </ul>
            <hr>
            <div class="d-flex flex-wrap align-items-center">
                <span class="icon grey mr-2 mb-2">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Price_tag" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<g>
	<path d="M19.388,0.405c-0.111-0.314-0.454-0.48-0.769-0.371c-0.315,0.109-0.481,0.455-0.372,0.77
		c0.929,2.67-0.915,4.664-2.321,5.732l-0.568-0.814c-0.191-0.273-0.618-0.5-0.95-0.504L11.22,5.232
		c-0.332-0.006-0.825,0.146-1.097,0.338l-9.394,6.587c-0.455,0.32-0.565,0.947-0.247,1.404l4.269,6.108
		c0.32,0.455,0.831,0.4,1.287,0.082l9.394-6.588c0.27-0.191,0.582-0.603,0.692-0.918l0.998-3.145
		c0.11-0.314,0.043-0.793-0.148-1.066l-0.346-0.496C18.516,6.091,20.476,3.534,19.388,0.405z M15.017,9.763
		c-0.727,0.51-1.731,0.332-2.24-0.396c-0.511-0.73-0.333-1.734,0.395-2.246C13.75,6.716,14.5,6.745,15.04,7.138
		c-0.272,0.164-0.459,0.26-0.494,0.275c-0.301,0.143-0.43,0.504-0.288,0.805c0.104,0.219,0.321,0.348,0.547,0.348
		c0.086,0,0.174-0.02,0.257-0.059c0.194-0.092,0.402-0.201,0.619-0.33C15.778,8.771,15.542,9.394,15.017,9.763z"/>
</g>
</svg>

                </span>
                
                    <a href="/list/posts.html#data-mining"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Data mining
                    </a>
                
                    <a href="/list/posts.html#data-linking"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Data linking
                    </a>
                
                    <a href="/list/posts.html#nlp"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        NLP
                    </a>
                
                    <a href="/list/posts.html#apps-script"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Apps Script
                    </a>
                
                    <a href="/list/posts.html#tutorial"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        Tutorial
                    </a>
                
            </div>
            <hr>
            <div class="d-flex align-items-center mt-2">
                <span class="icon grey mr-1">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Arrow_left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path d="M2.5,10L9,3.5V7h8v6H9v3.5L2.5,10z"/>
</svg>

                </span>
                <a href="/list/posts.html">Back to all posts</a>
            </div>
        </div>
    </div>
</div>

</div>

<p>On the importance of data a lot has been said. We are living in the age of data where we produce constantly data by our presence online. At some point in your career or your studies, you may need to create your own dataset according to your field knowledge for a specific task. Such a dataset, which is technically called a <strong>gold-standard</strong>, is used as a collection of trustable instances for applying machine learning techniques and training neural networks. <a href="https://www.mturk.com/" target="_blank">Amazon Mechanical Turk</a> is one of the famous platforms which enables individuals and businesses create and annotate datasets through crowdsourcing.</p>

<p><em>Data annotation</em>, as its name suggests, is the task of labelling data in various forms such as text, audio, image, video etc. In this post, one of the many functionalities of spreadsheets, particularly <strong>dropdown lists</strong>, for the task of data annotation is explored. I introduce a toy example of creating a dataset for sense linking using dropdown lists in spreadsheets. This example may not exactly fit into your case, but hopefully will give you a brighter idea of how much spreadsheets can be useful for annotating datasets instead of creating a program or a graphical interface.</p>

<p>This tutorial requires basic knowledge in using spreadsheets (<a href="https://www.google.com/sheets/about/" target="_blank">Google spreadsheets</a>) and also in JavaScript to use <a href="https://developers.google.com/apps-script/articles/tutorials" target="_blank">Google Apps Script</a>. <strong>Google Sheet</strong> is a service provided by Google for working with <a href="https://en.wikipedia.org/wiki/Spreadsheet" target="_blank">spreadsheet</a>s. <a href="https://developers.google.com/apps-script/" target="_blank"><strong>Apps Script</strong></a> is a JavaScript platform which makes manipulation and management of Google Docs, Sheets, Slides and Forms possible. In other terms, Google Apps Script is the programming language which uses your data on Google services.</p>

<h2 id="annotation-description">Annotation description</h2>

<p>Here is a toy example:</p>

<p>Suppose that you would like to create a gold standard dataset for a linking problem in a dictionary. We have two different sets of senses for the same entry in two dictionaries and the task of the annotators is to manually specify the corresponding senses. For instance, the senses of the word spring (noun) in <a href="https://www.wiktionary.org/" target="_blank">Wiktionary</a> and <a href="http://wordnetweb.princeton.edu/perl/webwn" target="_blank">WordNet</a>.</p>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-0z1f{background-color:#FCFBE3;border-color:#000000;text-align:left;vertical-align:top}
.tg .tg-73oq{border-color:#000000;text-align:left;vertical-align:top}
</style>

<table class="tg">
  <tr>
    <th class="tg-73oq">spring: sense set 1</th>
    <th class="tg-73oq">spring: sense set 2</th>
  </tr>
  <tr>
    <td class="tg-73oq">a leap; a bound; a jump</td>
    <td class="tg-0z1f">the season of growth</td>
  </tr>
  <tr>
    <td class="tg-73oq">a place where water or oil emerges from the ground</td>
    <td class="tg-0z1f">the elasticity of something that can be stretched and returns to its original length</td>
  </tr>
  <tr>
    <td class="tg-73oq">elastic power or force</td>
    <td class="tg-0z1f">a natural flow of ground water</td>
  </tr>
  <tr>
    <td class="tg-73oq">the time of growth and progress; early portion; first stage</td>
    <td class="tg-0z1f">a light, self-propelled movement upwards or forwards</td>
  </tr>
  <tr>
    <td class="tg-73oq">the property of a body of springing to its original form after being compressed, stretched, etc.</td>
    <td class="tg-0z1f"></td>
  </tr>
</table>

<p>For this purpose, spreadsheets can be used efficiently by:</p>

<p>1- Converting our data into a tabular format in a spreadsheet<br />
2- Add dependent dropdown lists automatically for facilitating annotation</p>

<h2 id="create-a-structure">Create a structure</h2>

<p>As the first step, we define a structure for our data representation in the tabular form. I would suggest the following:</p>
<iframe width="100%" height="510" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTn-iHZ29rENNJFzKDuyK5lb2n4x1BUjS4MN6UFQ-Z-Hq6VScvcTkzrg-fPME0Sw4EDII9mAaoN3MON/pubhtml?gid=766034385&amp;single=true&amp;widget=true&amp;headers=false"></iframe>

<ul>
  <li>column <code class="language-plaintext highlighter-rouge">A</code>: headwords</li>
  <li>column <code class="language-plaintext highlighter-rouge">B</code>: IDs of the senses in the sense set 1</li>
  <li>column <code class="language-plaintext highlighter-rouge">C</code>: senses in the sense set 1</li>
  <li>column <code class="language-plaintext highlighter-rouge">G</code>: senses in the sense set 2</li>
  <li>column <code class="language-plaintext highlighter-rouge">H</code>: IDs of the senses in the sense set 2</li>
</ul>

<p>We leave columns <code class="language-plaintext highlighter-rouge">D</code>, <code class="language-plaintext highlighter-rouge">E</code>, and <code class="language-plaintext highlighter-rouge">F</code> for automatically adding information according to the senses as follows:</p>

<ul>
  <li>column <code class="language-plaintext highlighter-rouge">D</code>: if the longer sense set is located in column <code class="language-plaintext highlighter-rouge">C</code>, then the dropdown lists appear in front of that column in column <code class="language-plaintext highlighter-rouge">D</code>. Otherwise, column <code class="language-plaintext highlighter-rouge">D</code> stays blank.</li>
  <li>column <code class="language-plaintext highlighter-rouge">F</code>: if the longer sense set is located in column <code class="language-plaintext highlighter-rouge">G</code>, then the dropdown lists appear before that column in column <code class="language-plaintext highlighter-rouge">F</code>. Otherwise, column <code class="language-plaintext highlighter-rouge">F</code> stays blank.</li>
  <li>column <code class="language-plaintext highlighter-rouge">E</code>: left blank on purpose. Maybe you can add something there as an exercise?!</li>
</ul>

<p>Our attention to the longer sense set is because of the fact that we want to annotate all the senses. If we only annotate the shortest sense set, we skip the other data which appear in the other (longer) set.</p>

<p>What we should keep in mind from the very first step is to create the spreadsheet based on a unique structure that allows us retrieve data correctly later. Setting IDs or specific symbols can be useful too.</p>

<h2 id="dependent-dropdown-lists">Dependent dropdown lists</h2>

<p>Now, we would like to add a dropdown list in the <code class="language-plaintext highlighter-rouge">Sense match</code> column in a way that for each headword, the available cells in the other side of the document appear in the dropdown list. This is dependent on the headword and the existing senses. Obviously, we cannot add such dropdown lists manually for a large dataset. Our solution is to create a simple function in Apps Script that does the job for us.</p>

<p>To use Apps Script for your spreadsheet, on your Google Sheet go to <strong>Tools</strong> &gt; <strong>Script editor</strong>. In the new tab, you’ll have a text editor like the following where you can execute your code:</p>

<div class="card mb-3 text-center">
    <img class="rounded mx-auto d-block" src="/docs/images/SheetAppsScript.png" style="width:100%" align="middle" alt="Apps Script in Google Sheet" />
    <div class="card-body bg-light">
        <div class="card-text">
            Apps Script in Google Sheet
        </div>
    </div>
</div>

<p>Let’s think about a solution to read the data and insert the dropdown lists in the right cells. Here is a strategy:</p>

<p>1- Find the location of the headwords in column <code class="language-plaintext highlighter-rouge">A</code>. To find the last headword, we put an “END” headword in the last row of the spreadsheet. <br />
2- Calculate how many cells come between the headwords. That is how long your longer sense set is. <br />
3- Find the side where the longer sense set is placed; in column <code class="language-plaintext highlighter-rouge">C</code> or <code class="language-plaintext highlighter-rouge">G</code>.<br />
4- Insert the content of the shorter sense set in dropdown lists.</p>

<p>We call our function <code class="language-plaintext highlighter-rouge">SenseDDLcreator</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">SenseDDLcreator</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSheet</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getDataRange</span><span class="p">().</span><span class="nx">getValues</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">headwordIndices</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="c1">// Find the location of the headwords</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">row</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">row</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span>  <span class="dl">""</span><span class="p">){</span>
      <span class="nx">headwordIndices</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
      <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">).</span><span class="nx">setBackground</span><span class="p">(</span><span class="dl">"</span><span class="s2">#A3C4FA</span><span class="dl">"</span><span class="p">).</span><span class="nx">setFontWeight</span><span class="p">(</span><span class="dl">"</span><span class="s2">bold</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// blue #A3C4FA and green #93c47d</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">senseLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">longSenseSide</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">headwordIndices</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>

    <span class="c1">// Calculate the length of the longest sense set for each headword</span>
    <span class="nx">senseLength</span> <span class="o">=</span> <span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    
    <span class="c1">// Find the position of the longer list of senses by checking the last sense row of the headword in ODS (column C) or DDO (column G)</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">senseLength</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">""</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">senseLength</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">""</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">senseLength</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">""</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">senseLength</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)){</span>
      <span class="nx">longSenseSide</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">senseLength</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="dl">""</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">senseLength</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">""</span><span class="p">){</span>
      <span class="nx">longSenseSide</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
      <span class="nx">longSenseSide</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Extract sense IDs of the target set of senses</span>
    <span class="kd">var</span> <span class="nx">otherSenses</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">validationRange</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">senseMap</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">2</span><span class="p">};</span>
    <span class="kd">var</span> <span class="nx">matchMap</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">6</span><span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">longSenseSide</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">longSenseSide</span> <span class="o">==</span> <span class="mi">6</span><span class="p">){</span>
      <span class="nx">otherSenses</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">senseLength</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">otherSenses</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">otherSenses</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="nx">senseMap</span><span class="p">[</span><span class="nx">longSenseSide</span><span class="p">]]</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="nx">validationRange</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">otherSenses</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="nx">senseMap</span><span class="p">[</span><span class="nx">longSenseSide</span><span class="p">]].</span><span class="nx">toString</span><span class="p">().</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="c1">// Insert the DropDown list in the correct place</span>
      <span class="kd">var</span> <span class="nx">validationRule</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">newDataValidation</span><span class="p">().</span><span class="nx">requireValueInList</span><span class="p">(</span><span class="nx">validationRange</span><span class="p">).</span><span class="nx">build</span><span class="p">();</span>
      <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">headwordIndices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="nx">matchMap</span><span class="p">[</span><span class="nx">longSenseSide</span><span class="p">],</span> <span class="nx">senseLength</span><span class="p">).</span><span class="nx">setDataValidation</span><span class="p">(</span><span class="nx">validationRule</span><span class="p">);</span>

      
      <span class="c1">//Logger.log(validationRange);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">sheet</span><span class="p">.</span><span class="nx">hideColumns</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="nx">sheet</span><span class="p">.</span><span class="nx">hideColumns</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And this is the magical output! The content of each dropdown list corresponds to the specificity of each headword.</p>

<div class="card mb-3 text-center">
    <img class="rounded mx-auto d-block" src="/docs/images/sense_linking_annotation.png" style="width:100%" align="middle" alt="Data for annotation using dropdown lists" />
    <div class="card-body bg-light">
        <div class="card-text">
            Automatically added drop down lists to a sheet for annotation
        </div>
    </div>
</div>

<p>To learn more about Google Apps Script, visit <a href="https://developers.google.com/apps-script/guides/sheets" target="_blank">https://developers.google.com/apps-script/guides/sheets</a>.</p>

<hr class="col-xs-12" />

<p>Last updated on 1 August 2019.</p>


<script type="text/javascript">
    $(document).ready(function() {
        var tpl =
            "<li class='nav-item'>\
                <a class='nav-link bg-white mb-1' href='#header[idx]'>[name]</a>\
            </li>"
        $("h2").each(function(idx, h2) {
            $(h2).attr("id", "header" + idx)
            var name = $(h2).text().trim()
            var dom_string = tpl.replace("[name]", name).replace("[idx]", idx)
            var header = $(dom_string)
            $(".header-list").append(header)
        })
    })
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  extensions: [
    "tex2jax.js", 
    "MathMenu.js",
    "MathZoom.js",
    "AssistiveMML.js",
    "a11y/accessibility-menu.js"
  ],
  tex2jax: {   
    inlineMath: [['$', '$']],
    displayMath: [['$$', '$$']]
  },
    jax: ["input/TeX", "output/CommonHTML"],
    TeX: {
      extensions: [
        "AMSmath.js",
        "AMSsymbols.js",
        "noErrors.js",
        "noUndefined.js",
      ]
    }
  });
  MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
    var TEX = MathJax.InputJax.TeX;
    var COLS = function (W) {
      var WW = [];
      for (var i = 0, m = W.length; i < m; i++)
        {WW[i] = TEX.Parse.prototype.Em(W[i])}
      return WW.join(" ");
    };
    TEX.Definitions.Add({
      environment: {
        psmallmatrix: ['Array',null,'(',')','c',COLS([1/3]),".2em",'S',1],
      }
    });
  });
</script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js">
</script>


        </div>
        <div class="col-md-12 d-lg-none bottom">
            

        </div>
    </div>
</div>

<script type="text/javascript">
/*!
 * IE10 viewport hack for Surface/desktop Windows 8 bug
 * Copyright 2014-2017 The Bootstrap Authors
 * Copyright 2014-2017 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

// See the Getting Started docs for more information:
// https://getbootstrap.com/getting-started/#support-ie10-width

(function () {
    'use strict'

    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
        var msViewportStyle = document.createElement('style')
        msViewportStyle.appendChild(
            document.createTextNode(
                '@-ms-viewport{width:auto!important}'
            )
        )
        document.head.appendChild(msViewportStyle)
    }
}())
</script>



</body>

</html>
